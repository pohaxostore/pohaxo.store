<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard</title>
   <script type="module">
    import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";

    const supabaseUrl = "https://jmtblmywbuigkgteaaky.supabase.co";
    const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImptdGJsbXl3YnVpZ2tndGVhYWt5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzcwNTc0MzUsImV4cCI6MjA1MjYzMzQzNX0.2d0_wH5uaKX64FxiR3RYmGevh2cF6Vs7VQ0k6zptIqI";

    const supabase = createClient(supabaseUrl, supabaseKey);
    window.supabase = supabase; // 🔥 مهم حتى يمكنك استخدامه في سكريبت آخر

    // ✅ استدعاء التحقق من تسجيل الدخول مباشرة
    checkLogin();
</script>

    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #ddd; padding: 10px; text-align: center; }
        th { background-color: #f4f4f4; }
        input, button { margin: 10px; padding: 8px; }
        #login-section { text-align: center; margin-top: 50px; }
    </style>
</head>
<body>
    <h1>Admin Dashboard</h1>

    <!-- 🛠️ نموذج تسجيل الدخول -->
    <div id="login-section">
        <h2>Login</h2>
        <input type="email" id="email" placeholder="Email">
        <input type="password" id="password" placeholder="Password">
        <button onclick="login()">Login</button>
        <p id="error-message" style="color: red;"></p>
    </div>

    <!-- 🛠️ لوحة التحكم (مخفية حتى يتم تسجيل الدخول) -->
    <div id="dashboard-section" style="display: none;">
        <h2>Orders</h2>
        <table>
            <thead>
                <tr>
                    <th>Order ID</th>
                    <th>Customer</th>
                    <th>Address</th>
                    <th>Products</th>
                    <th>Total Amount</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody id="orders-table"></tbody>
        </table>
        <button onclick="logout()">Logout</button>
    </div>

    <script>
        // 🛠️ بيانات الاتصال بـ Supabase
        const supabaseUrl = 'https://jmtblmywbuigkgteaaky.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImptdGJsbXl3YnVpZ2tndGVhYWt5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzcwNTc0MzUsImV4cCI6MjA1MjYzMzQzNX0.2d0_wH5uaKX64FxiR3RYmGevh2cF6Vs7VQ0k6zptIqI';
        const supabase = supabase.createClient(supabaseUrl, supabaseKey);

        // ✅ تسجيل الدخول
        async function login() {
            const email = document.getElementById("email").value;
            const password = document.getElementById("password").value;

            const { data, error } = await supabase.auth.signInWithPassword({ email, password });

            if (error) {
                document.getElementById("error-message").innerText = "Login failed! Check your credentials.";
                return;
            }

            localStorage.setItem("user", JSON.stringify(data.user));
            checkLogin();
        }

        // ✅ تسجيل الخروج
        function logout() {
            localStorage.removeItem("user");
            document.getElementById("dashboard-section").style.display = "none";
            document.getElementById("login-section").style.display = "block";
        }

        // ✅ التحقق من تسجيل الدخول عند تحميل الصفحة
        async function checkLogin() {
            const user = JSON.parse(localStorage.getItem("user"));

            if (!user) {
                document.getElementById("login-section").style.display = "block";
                document.getElementById("dashboard-section").style.display = "none";
                return;
            }

            document.getElementById("login-section").style.display = "none";
            document.getElementById("dashboard-section").style.display = "block";
            fetchOrders();
        }

        document.addEventListener("DOMContentLoaded", checkLogin);

        // ✅ تحميل الطلبات بعد تسجيل الدخول
        async function fetchOrders() {
            const { data, error } = await supabase.from("orders").select("*");

            if (error) {
                console.error("Error fetching orders:", error);
                return;
            }

            const tableBody = document.getElementById("orders-table");
            tableBody.innerHTML = "";

            data.forEach(order => {
                const productDetails = order.products.map(p => 
                    `${p.product} (Size: ${p.size}, Qty: ${p.quantity})`
                ).join('<br>');

                tableBody.innerHTML += `
                    <tr>
                        <td>${order.id}</td>
                        <td>${order.name}</td>
                        <td>${order.address}</td>
                        <td>${productDetails}</td>
                        <td>${order.total_amount} USD</td>
                        <td>${order.status}</td>
                    </tr>
                `;
            });
        }
    </script>
</body>
</html>


