<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Your Cart</title>
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      margin: 0;
      padding: 0;
      background: #f5f5f5;
    }
    header {
      background: #222;
      color: white;
      text-align: center;
      padding: 20px;
    }
    table {
      width: 95%;
      margin: 20px auto;
      border-collapse: collapse;
      background: white;
      border-radius: 10px;
      overflow: hidden;
    }
    th, td {
      padding: 12px;
      text-align: center;
      border-bottom: 1px solid #ddd;
    }
    .total {
      font-weight: bold;
      font-size: 18px;
      text-align: right;
      padding: 20px;
      width: 95%;
      margin: auto;
    }
    .checkout-btn {
      display: block;
      margin: 20px auto;
      padding: 12px 24px;
      background: #ff758c;
      color: white;
      border: none;
      border-radius: 5px;
      font-size: 16px;
      cursor: pointer;
    }
    select, input[type=number] {
      padding: 4px;
    }
  </style>
</head>
<body>
  <header>
    <h1>Your Cart</h1>
  </header>

  <table>
    <thead>
      <tr>
        <th>Product</th>
        <th>Size</th>
        <th>Price</th>
        <th>Qty</th>
        <th>Shipping</th>
        <th>Total</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody id="cart-items"></tbody>
  </table>

  <div class="total">
    Total: <span id="total-price">0.00 USD</span>
  </div>

  <button class="checkout-btn" onclick="checkout()">Checkout</button>

  <script>
    let cart = JSON.parse(localStorage.getItem('cart')) || [];

    const productShippingRates = {
      "Nike Shoes": { "USA": 10, "Morocco": 15, "Other": 20 },
      "Balaclava Zip": { "USA": 7, "Morocco": 2, "Other": 10 },
      "T-Shirt": { "USA": 10, "Morocco": 15, "Other": 20 },
      "Jacket": { "USA": 10, "Morocco": 15, "Other": 20 },
      "Watch": { "USA": 5, "Morocco": 5, "Other": 8 }
    };

    function formatPrice(price) {
      return parseFloat(price).toFixed(2);
    }

    function updateSize(index, newSize) {
      cart[index].size = newSize;
      localStorage.setItem('cart', JSON.stringify(cart));
    }

    function updateQuantity(index, quantity) {
      if (quantity < 1) return;
      cart[index].quantity = parseInt(quantity);
      localStorage.setItem('cart', JSON.stringify(cart));
      updateCart();
    }

    function updateShipping(index, country) {
      cart[index].shipping = country;
      localStorage.setItem('cart', JSON.stringify(cart));
      updateCart();
    }

    function removeItem(index) {
      cart.splice(index, 1);
      localStorage.setItem('cart', JSON.stringify(cart));
      updateCart();
    }

    function updateCart() {
      const cartItems = document.getElementById('cart-items');
      const totalPriceElement = document.getElementById('total-price');
      cartItems.innerHTML = '';
      let total = 0;

      if (!cart || cart.length === 0) {
        cartItems.innerHTML = `<tr><td colspan="7">Your cart is empty.</td></tr>`;
        totalPriceElement.textContent = "0.00 USD";
        return;
      }

      cart.forEach((item, index) => {
        const shippingCost = productShippingRates[item.name]?.[item.shipping] || 0;
        const itemTotal = (item.price * item.quantity) + shippingCost;
        total += itemTotal;

        let sizeField = '-';
        if (item.name.includes("Shoes")) {
          const shoeSizes = [37, 38, 39, 40, 41, 42];
          sizeField = `<select onchange="updateSize(${index}, this.value)">
            ${shoeSizes.map(size => `<option value="${size}" ${item.size == size ? 'selected' : ''}>${size}</option>`).join('')}
          </select>`;
        } else if (["T-Shirt", "Pant", "Jacket", "Hoodie", "Balaclava Zip"].some(keyword => item.name.includes(keyword))) {
          const clothingSizes = ["S", "M", "L", "XL"];
          sizeField = `<select onchange="updateSize(${index}, this.value)">
            ${clothingSizes.map(size => `<option value="${size}" ${item.size == size ? 'selected' : ''}>${size}</option>`).join('')}
          </select>`;
        }

        cartItems.innerHTML += `
          <tr>
            <td>${item.name}</td>
            <td>${sizeField}</td>
            <td>${formatPrice(item.price)} USD</td>
            <td><input type="number" min="1" value="${item.quantity}" onchange="updateQuantity(${index}, this.value)"></td>
            <td>
              <select onchange="updateShipping(${index}, this.value)">
                <option value="USA" ${item.shipping === "USA" ? "selected" : ""}>USA</option>
                <option value="Morocco" ${item.shipping === "Morocco" ? "selected" : ""}>Morocco</option>
                <option value="Other" ${item.shipping === "Other" ? "selected" : ""}>Other</option>
              </select>
            </td>
            <td>${formatPrice(itemTotal)} USD</td>
            <td><button onclick="removeItem(${index})">Remove</button></td>
          </tr>`;
      });

      totalPriceElement.textContent = formatPrice(total) + " USD";
    }

    function checkout() {
      alert("Redirecting to checkout...");
      window.location.href = "checkout.html";
    }

    document.addEventListener('DOMContentLoaded', updateCart);
  </script>
</body>
</html>
